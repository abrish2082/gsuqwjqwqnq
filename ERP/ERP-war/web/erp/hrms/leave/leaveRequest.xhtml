<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    template="../../../resources/templates/template.xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">


    <ui:define name="navigaion_content">
        <li><a href="../hrmsDashboard.xhtml"><i class="fa fa-fw fa-dashboard"></i> <span>Dashboard</span></a></li>
        <li><a href="leaveSetting.xhtml"><i class="fa fa-fw"></i> <span>Leave Setting </span></a></li>
        <li>    <a href="leaveApproveDep.xhtml"><i class="fa fa-fw"></i>  <span>Leave Approve Dept</span></a> </li>
        <li>    <a href="leaveApproveHr.xhtml"><i class="fa fa-fw"></i>  <span>Leave Approve HR </span></a></li>
        <li>   <a href="leaveReturn.xhtml"><i class="fa fa-fw"></i>  <span>Employees On Leave </span></a></li>
        <li>    <a href="leaveBalance.xhtml"><i class="fa fa-fw"></i> <span>Generate Leave Balance </span></a> </li> <li>    <a href="leaveSchedule.xhtml"><i class="fa fa-fw"></i> <span>Leave Schedule </span></a> </li>
        <li> <a href="holiday.xhtml"><i class="fa fa-fw"></i>  <span>Manage Holiday  </span>  </a></li>

    </ui:define>
    <ui:define name="contents">
        <h:form id="frmSample"> 
            <p:toolbar  style="background-color:white;border-color: white">
                <f:facet name="right">
      <h:panelGroup id="pnlworkflowIcon">
                        <p:commandLink id="cmdLinkWf" class="fa fa-fw fa-gear" 
                                       title="Work Flow" style="background-color: white; border-color: white;"/>
                        <p:overlayPanel widgetVar="wdvWf" showEffect="fade" hideEffect="fade" showCloseIcon="true" for="cmdLinkWf"
                                        class="col-md-4" style="height: 400px">
                            <p:outputLabel id="lblFaWf" value="Work Flow"/>
                            <div class="row"> 
                                <div class="col-md-12" > 
                                    <h:form id="frmWf"> 
                                        <div class="form-horizontal col-sm-12">
                                            <div class="form-group">                                        
                                                <div class="col-sm-12">
                                                    <p:dataTable id="tblWorkflow" value="#{leaveRequest.workflowDataModel}" 
                                                                 var="currentRow" rowIndexVar="num" class="dataTable" rows="10" paginator="true"
                                                                 rowKey="#{currentRow}" paginatorPosition="bottom">
                                                        <p:column headerText="Processed By">
                                                            <h:outputText value="#{currentRow.processedBy}"/> 
                                                        </p:column>
                                                        <p:column >
                                                            <f:facet name="header">
                                                                <h:outputText value="Decision"/>
                                                            </f:facet>
                                                            <h:outputText value="#{currentRow.decision}"/> 
                                                        </p:column>
                                                        <p:column >
                                                            <f:facet name="header">
                                                                <h:outputText value="Comment Given"/>
                                                            </f:facet>
                                                            <h:outputText value="#{currentRow.commentGiven}"/> 
                                                        </p:column>
                                                        <p:column >
                                                            <f:facet name="header">
                                                                <h:outputText value="Processed Date"/>
                                                            </f:facet>
                                                            <h:outputText value="#{currentRow.processedOn}"/> 
                                                        </p:column> 
                                                    </p:dataTable>
                                                </div>
                                            </div>
                                        </div>    
                                    </h:form>
                                </div>
                            </div>
                        </p:overlayPanel>
                        <span class="ui-separator">
                            <span class="ui-icon ui-icon-grip-dotted-vertical" />
                        </span>
                    </h:panelGroup>

                    <span class="ui-separator">
                        <span class="ui-icon ui-icon-grip-dotted-vertical"/>
                    </span>
                    <a href="leaveRequest.xhtml"><i class="fa fa-fw fa-refresh" title="Refresh"></i></a>

                    <span class="ui-separator">
                        <span class="ui-icon ui-icon-grip-dotted-vertical" />
                    </span>
                    <a href="../hrmsDashboard.xhtml"><i class="fa fa-fw fa-dashboard" title="Dashboard"></i></a>
                    <span class="ui-separator">
                        <span class="ui-icon ui-icon-grip-dotted-vertical"/>
                    </span>
                </f:facet>
            </p:toolbar>

        </h:form>

        <div class="row">
            <div class="col-md-12">
                <div class="box box-primary ">
                    <div class="box-header">
                        <h3 class="box-title">Leave Request </h3>  
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body ">
                        <div class="box-body ">
                            <h:form id="frmLeaveReq">
                                <p:growl id="growl" showDetail="true" autoUpdate="true" severity="information,fatal" />    

                                <div class="nav-tabs-custom">
                                    <ul class="nav nav-tabs">
                                        <li class="active">
                                            <a href="#tabLeaveRequest" data-toggle="tab">Leave Request</a></li>
                                        <li><a href="#tabLeaveBalence" data-toggle="tab">Leave Balance</a></li>
                                        <li><a href="#tabLeaveHistory" data-toggle="tab">Leave History</a></li>
                                    </ul>
                                    <div class="tab-content" id="maintab">
                                        <div class="active tab-pane" id="tabLeaveRequest">
                                            <h:panelGroup id="pngLeaveRequest">  
                                                <section class="panel panel-info" id="pnl1">
                                                    <section class="panel-body">

                                                        <div class="col-sm-12">
                                                            <div class="col-sm-6"> 
                                                                <div class="form-horizontal col-md-12">
                                                                    <div class="form-group">
                                                                        <label for="txtEmpID" class="control-label col-sm-4" >Employee ID:</label>
                                                                        <div class="col-sm-8">
                                                                            <p:autoComplete   id="txtEmpID" placeholder="Enter Your ID Here" value="#{leaveRequest.employee.empId}" 
                                                                                              emptyMessage="Employee not exit"     maxResults="10"      style="width: 100%"  
                                                                                              completeMethod="#{leaveRequest.searchEmployee}" required="true"
                                                                                              var="emp" itemValue="#{emp.empId}" itemLabel="#{emp}"   >
                                                                                <p:column headerText="ID"  >
                                                                                    <h:outputText value="#{emp.empId}" />
                                                                                </p:column>
                                                                                <p:column headerText="First Name" >
                                                                                    <h:outputText  value="#{emp.firstName}" />
                                                                                </p:column>
                                                                                <p:column  headerText="Last Name">
                                                                                    <h:outputText value="#{emp.lastName}" />
                                                                                </p:column>
                                                                                <p:ajax  event="itemSelect" listener="#{leaveRequest.getEmployeeInfo}" process="@this" 
                                                                                         update="@this,menuLeaveType,txtFirstName,txtMiddleName,txtLastName" /> 
                                                                            </p:autoComplete> 
                                                                            <p:message for="txtEmpID" display="icon"/>  
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-12">
                                                            <div class="col-sm-6"> 
                                                                <div class="form-horizontal col-md-12">
                                                                    <div class="form-group">
                                                                        <label for="txtFirstName" class="control-label col-sm-4" >First Name:</label>
                                                                        <div class="col-sm-8"> 
                                                                            <p:inputText id="txtFirstName" value="#{leaveRequest.employee.firstName}"  readonly="true" class="form-control"/>
                                                                            <p:message for="txtFirstName" display="icon"/>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-12">
                                                            <div class="col-sm-6"> 
                                                                <div class="form-horizontal col-md-12">
                                                                    <div class="form-group">
                                                                        <label for="txtMiddleName" class="control-label col-sm-4" >Middle Name:</label>
                                                                        <div class="col-sm-8"> 
                                                                            <p:inputText id="txtMiddleName" value="#{leaveRequest.employee.middleName}"  readonly="true" class="form-control"
                                                                                         /> 
                                                                            <p:message for="txtMiddleName" display="icon"/>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-12">
                                                            <div class="col-sm-6"> 
                                                                <div class="form-horizontal col-md-12">
                                                                    <div class="form-group">
                                                                        <label for="txtLastName" class="control-label col-sm-4" >Last Name:</label>
                                                                        <div class="col-sm-8"> 
                                                                            <p:inputText id="txtLastName" value="#{leaveRequest.employee.lastName}"  readonly="true" class="form-control"/>
                                                                            <p:message for="txtLastName" display="icon"/>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-sm-12">
                                                            <div class="col-sm-6"> 
                                                                <div class="form-horizontal col-md-12">
                                                                    <div class="form-group">
                                                                        <label for="menuLeaveType" class="control-label col-sm-4" >Leave Type</label>
                                                                        <div class="col-sm-8">
                                                                            <p:selectOneMenu id="menuLeaveType"  value="#{leaveRequest.leaveRequest.leaveTypesId}" converter="entConverter" style="width: 100%" 
                                                                                             valueChangeListener="#{leaveRequest.leaveTyp}" required="true"  >
                                                                                <p:ajax event="change" process="@this" update="@this,pnlSaveEmp,pngLeaveRequest,panelLeaveHistory,txtNoOfDays,tblleaveBalance2,pnlLeaveBalance,txtLeaveEndDate,btnCalcEndDate" />
                                                                                <f:selectItems value="#{leaveRequest.leavetypeList}"/>
                                                                            </p:selectOneMenu>                        
                                                                            <p:message for="menuLeaveType" display="icon"/>  
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-sm-12">
                                                            <div class="col-sm-6"> 
                                                                <div class="form-horizontal col-md-12">
                                                                    <div class="form-group">
                                                                        <label for="txtNoOfDays" class="control-label col-sm-4" >No of Days:</label>
                                                                        <div class="col-sm-8"> 
                                                                            <p:inputText id="txtNoOfDays" value="#{leaveRequest.leaveRequest.requestedDays}" required="true" class="form-control"
                                                                                        > 
                                                                                <p:ajax></p:ajax>
                                                                            </p:inputText>
                                                                            <p:message for="txtNoOfDays" display="icon"/>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-sm-12">
                                                            <div class="col-sm-6"> 
                                                                <div class="form-horizontal col-md-12">
                                                                    <div class="form-group">
                                                                        <label for="txtLeaveStart" class="control-label col-sm-4" >Leave Start:</label>
                                                                        <div class="col-sm-8"> 

                                                                            <p:inputText id="txtLeaveStart" value="#{leaveRequest.leaveRequest.leaveStart}" class="form-control"
                                                                                         converter="dateConverter" required="true"
                                                                                         placeholder="dd/mm/yyyy" onclick="displayCalendar('frmLeaveReq:txtLeaveStart', 'frmLeaveReq:txtLeaveStart');" />
                                                                            <p:message for="txtLeaveStart" display="icon"/>

                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-12">
                                                            <div class="col-sm-6"> 
                                                                <div class="form-horizontal col-md-12">
                                                                    <div class="form-group">
                                                                        <label for="drlDayss" class="control-label col-sm-4" >Full/Half Days:</label>
                                                                        <div class="col-sm-8"> 
                                                                            <p:selectOneMenu id="drlDayss" value="#{leaveRequest.leaveRequest.halfOrFull}" required="true" style="width: 100%" 
                                                                                             >
                                                                                <f:selectItem itemLabel="Select One"  itemValue="#{null}" />
                                                                                <f:selectItem itemLabel="Half Day" itemValue="Half Day" />
                                                                                <f:selectItem itemLabel="Full Day" itemValue="Full Day" />
                                                                                <p:ajax event="change" process="@this,:frmLeaveReq,:frmLeaveReq:txtLeaveStart" update="txtLeaveEndDate,txtNoOfDays" />
                                                                            </p:selectOneMenu>
                                                                            <p:message for="drlDayss" display="icon"/>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-sm-12">
                                                            <div class="col-sm-6"> 
                                                                <div class="form-horizontal col-md-12">
                                                                    <div class="form-group">
                                                                        <label for="txtLeaveEndDate" class="control-label col-sm-4" >Return Date:</label>
                                                                        <div class="col-sm-8"> 
                                                                            <p:inputText id="txtLeaveEndDate" value="#{leaveRequest.leaveRequest.leaveEnd}" class="form-control"  
                                                                                         converter="dateConverter"  readonly="true" />                                       
                                                                            <p:message for="txtLeaveEndDate" display="icon"/>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-12">
                                                            <div class="col-sm-6"> 
                                                                <div class="form-horizontal col-md-12">
                                                                    <div class="form-group">
                                                                        <p:outputLabel class="control-label col-sm-4" value="Description:"/>
                                                                        <div class="col-sm-8"> 
                                                                            <p:inputTextarea id="texDesc" value="#{leaveRequest.leaveRequest.description}"
                                                                                             class="form-control" rows="1" cols="5" autoResize="false" />  
                                                                            <p:message for="texDesc" display="icon"/>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </section> 
                                                </section>
                                            </h:panelGroup>


                                            <div class="col-sm-12">

                                                <h:panelGroup id="pnlSaveEmp">
                                                    <section class="panel panel-info">
                                                        <section class="panel-body">
                                                            <div class="panel-body col-sm-12">
                                                                <div class="form-group col-sm-12">
                                                                    <div class="col-sm-6">
                                                                        <div class="col-sm-12 form-horizontal">
                                                                            <div class="col-sm-4">  
                                                                                <p:commandButton id="btnCalcEndDate" class="btn  btn-block btn-primary col-lg-4" disabled="#{leaveRequest.renderSave}"
                                                                                                 value="Return Date" action="#{leaveRequest.calculateReturnDateLeaveRequest}" 
                                                                                                 process="@this,:frmLeaveReq" update="@this,:frmLeaveReq"/> 
                                                                            </div>                                                                    
                                                                            <div class="col-sm-4">
                                                                                <p:commandButton id="btnSave1" class="btn  btn-block btn-primary col-lg-4"  value="#{leaveRequest.saveOrUpdateButton}" disabled="#{leaveRequest.renderSave}"
                                                                                                 action="#{leaveRequest.saveLeaveRequest}" 
                                                                                                 process="@this,pngLeaveRequest" update="@this,:frmLeaveReq,growl"/> 
                                                                            </div>
                                                                            <div class="col-sm-4">
                                                                                <p:commandButton id="btnNew" value="Reset" class="btn  btn-block btn-primary col-lg-4" action="#{leaveRequest.clearLeaveRequest}"                                           
                                                                                                 process="@this" update="@this,:frmLeaveReq"  /> 
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                        </section>
                                                    </section>
                                                </h:panelGroup>
                                            </div>
                                        </div>

                                        <div class=" tab-pane" id="tabLeaveBalence">   

                                            <h:panelGroup id="pnlLeaveBalance">
                                                <div class="col-sm-12">
                                                    <div class="col-sm-6"> 
                                                        <div class="form-horizontal col-md-12">
                                                            <div class="form-group">
                                                                <h:outputLabel  value="Allowed Leave days:" class="control-label col-sm-4"/>
                                                                <div class="col-sm-8"> 
                                                                    <h:outputLabel id="totallvdays"   value="#{leaveRequest.totalLeaveDays}" />

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                      <p:dataTable id="tblleaveBalance2" var="balanceInfo" rows="3" 
                                                                   rowIndexVar="Det" value="#{leaveRequest.balanceDataModel}" 
                                                                   class="dataTable"    
                                                                   paginator="true" paginatorPosition="bottom"
                                                                   paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                                   rowsPerPageTemplate="5,10,15"    >
                                                    <p:column  headerText="NO">
                                                                <h:outputText  value="#{Det+1}"/>
                                                    </p:column> 
                                                        
                                                        <p:column headerText="Leave Year">
                                                                <h:outputText value="#{balanceInfo.leaveYearId.budgetYear}"/>
                                                         </p:column>
                                                    <p:column headerText="Total Days">
                                                               <h:outputText value="#{balanceInfo.totalDays}"/>
                                                    </p:column>                                 
                                                    <p:column headerText="Remaining Days">
                                                                  <h:outputText value="#{balanceInfo.remainingDays}"/>
                                                    </p:column>
                                                        <p:summaryRow>
                                                        <p:column colspan="2" style="text-align:right">
                                                            <h:outputText value="Allowed Leave days:" />
                                                        </p:column>
                                                        <p:column>
                                                            <h:outputText value="#{leaveRequest.totalLeaveDays}">                                                                
                                                            </h:outputText>
                                                        </p:column>
                                                    </p:summaryRow>
                                                </p:dataTable>
                                            </h:panelGroup>
                                        </div>

                                        <div class=" tab-pane" id="tabLeaveHistory">   
                                            <h:panelGroup id="panelLeaveHistory">
                                                <p:dataTable id="tblleaveStat" var="requestDetail"
                                                             rowIndexVar="Det" value="#{leaveRequest.leaveRequestDataModel}" 
                                                             class="dataTable"     rows="10"
                                                             selectionMode="single" 
                                                             selection="#{leaveRequest.selectedCriteria}"  rowKey="#{requestDetail}" 
                                                             paginator="true" paginatorPosition="bottom"
                                                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                             rowsPerPageTemplate="5,10,15" >  

                                                    <p:ajax  event="rowSelect" listener="#{leaveRequest.populateLeaveRequest}" update="@this,:frmLeaveReq,:frmSample"/>

                                                        <p:column  headerText="NO">
                                                                <h:outputText  value="#{Det+1}"/>
                                                    </p:column> 
                                                        <p:column headerText="Year"  sortBy="#{requestDetail.leaveYear.luBudgetYearId.budgetYear}">
                                                                <h:outputText value="#{requestDetail.leaveYear.luBudgetYearId.budgetYear}"/>
                                                    </p:column>
                                                    <p:column headerText="Leave Type">
                                                                <h:outputText value="#{requestDetail.leaveTypesId.leaveName}"/>
                                                         </p:column>
                                                        <p:column headerText="Requested days">
                                                                <h:outputText value="#{requestDetail.requestedDays}"/>
                                                         </p:column>
                                                        <p:column headerText="Approved Days">
                                                               <h:outputText value="#{requestDetail.approvedDays}"/>
                                                    </p:column>                                 
                                                    <p:column headerText="Type">
                                                                  <h:outputText value="#{requestDetail.halfOrFull}"/>
                                                    </p:column>
                                                    <p:column headerText="From">     
                                                        <h:outputText value="#{requestDetail.leaveStart}"/>
                                                    </p:column>
                                                    <p:column headerText="To">     
                                                        <h:outputText value="#{requestDetail.leaveEnd}"/>
                                                    </p:column>
                                                    <p:column headerText="Dep Approval">
                                                                  <h:outputText value="#{requestDetail.status1}"/>
                                                    </p:column>
                                                    <p:column headerText="HR Approval">
                                                                  <h:outputText value="#{requestDetail.status2}"/>
                                                    </p:column>
                                                    <p:column headerText="Attachment">                                                         
                                                                  <p:commandLink value="Attachment"/>
                                                    </p:column>
                                                </p:dataTable>
                                            </h:panelGroup>
                                        </div>    
                                    </div>
                                </div>
                            </h:form>
                        </div>

                    </div>                   
                </div>
            </div>
        </div>
    </ui:define>
</ui:composition>
